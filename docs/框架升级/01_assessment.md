# 当前框架评估

> 文档版本: 2026-01-23
> 模块: 框架现状分析

---

## 1.1 总体评分: 8.2/10

| 维度 | 评分 | 说明 |
|------|------|------|
| 功能完整性 | 9/10 | 扫描/回测/风控/对账全流程覆盖 |
| 代码质量 | 7.8/10 | 入口已拆分（cli.py/cli_commands.py），但命令实现仍偏大、缺测试 |
| 易用性 | 8/10 | 命令行丰富，文档详细 |
| 可扩展性 | 8/10 | 模块化设计好 |
| 稳定性 | 7.2/10 | 依赖外部数据源（AkShare/TuShare），需要缓存/降级与人工监控 |
| 风险控制 | 8.5/10 | 止损/止盈/panic兜底完善 |

---

## 1.2 核心优势

- ✅ **多流派共存**（缠论/威科夫/一目/海龟/Momentum/Dow/VSA）
- ✅ **收缩胜率防小样本吹牛**（Beta-Binomial先验）
- ✅ **成本模型严谨**（买卖分离、MAE实测）
- ✅ **组合风险视角**（相关性过滤、集中度检查）
- ✅ **闭环对账设计**（审计链完整）

---

## 1.3 主要局限

| 问题 | 影响 | 优先级 |
|------|------|--------|
| **静态策略架构** | BBB/短线/激进策略独立实现，无法复用 | P0 |
| **因子权重写死** | 无法根据市场状态动态调整 | P2 |
| **缺乏因子研究** | 不知道哪个因子真的有效 | P0 |
| **缺少“小散执行层”** | 没有 CashSignal/OpportunityScore/PositionSizing，容易过度交易 | P0 |
| **博弈/资金流/宏观 proxy 未因子化** | 只能当口播，无法验证有效性 | P1 |
| cmd实现集中在cli_commands.py(7000+行) | 维护仍困难，需按命令拆分 | P1 |
| 零单元测试覆盖 | 改代码就是裸奔 | P1 |
| 异常处理过于宽泛 | 623处except Exception，bug被默默吞掉 | P1 |

---

## 1.4 代码量统计

```
llm_trading/
├── cli.py              # ~1,070行 (入口+argparse)
├── cli_commands.py     # ~7,080行 (所有cmd_*实现)
├── backtest.py         # ~1,200行
├── holdings.py         # ~800行
├── positioning.py      # ~600行
├── etf_scan.py         # ~900行
├── stock_scan.py       # ~700行
├── (removed) shortline_scan.py   # 已精简移除（原~500行）
├── indicators.py       # ~400行
├── factors/            # ~1,500行 (17个因子)
└── ... 其他模块
─────────────────────────
总计: ~32,000行 Python
```

---

## 1.5 架构瓶颈分析

### 当前架构问题

```
┌─────────────────────────────────────────────────────────────────────┐
│                         当前架构                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   BBB策略 ──→ 独立判断逻辑 ──→ 信号                                  │
│   短线策略 ──→ 独立判断逻辑 ──→ 信号                                  │
│   激进策略 ──→ 独立判断逻辑 ──→ 信号                                  │
│                                                                     │
│   问题:                                                             │
│   - 相似的MA/MACD/RSI计算在多处重复                                  │
│   - 无法验证哪个因子真正有效                                         │
│   - 策略权重硬编码，无法动态调整                                     │
│   - 新策略需要写大量重复代码                                         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 目标架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                         目标架构                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   K线/资金/宏观 ──→ 因子库 ──→ 因子研究 ──→ 评分/过滤器 ──→ 执行/复盘 │
│                    (17+扩展)  (IC/IR)     (Cash/Score)   (T+1/成本)   │
│                                                                     │
│   优势:                                                             │
│   - 因子计算一次，策略复用                                           │
│   - 因子有效性可验证（IC/IR分析）                                    │
│   - 先“并行输出评分/过滤器”，再逐步启用（降低回归风险）              │
│   - 新策略 = 新配置，无需写代码                                      │
│   - ML友好：因子分数可作为特征                                       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 相关文档

- [红线约束](./00_constraints.md) - 必须遵守的研究规范
- [因子化架构](./02_factor_architecture.md) - 升级方案详情
- [代码改进](./03_code_improvements.md) - 代码层面优化

---

**下次评估**: 因子研究闭环完成后重新评估
